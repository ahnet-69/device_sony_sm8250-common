From 1a52dd4ad0ea2bdf2aaa11bcdff1a46ba556db46 Mon Sep 17 00:00:00 2001
From: minaripenguin <minaripenguin@users.noreply.github.com>
Date: Tue, 21 May 2024 11:51:26 +0800
Subject: [PATCH] display: Introduce X-Reality Engine display mode [2/2]

Signed-off-by: minaripenguin <minaripenguin@users.noreply.github.com>
---
 .../display/ColorModePreferenceFragment.java  | 44 ++++++++++++++++++-
 1 file changed, 43 insertions(+), 1 deletion(-)

diff --git a/src/com/android/settings/display/ColorModePreferenceFragment.java b/src/com/android/settings/display/ColorModePreferenceFragment.java
index ce33e67..ece50e5 100644
--- a/src/com/android/settings/display/ColorModePreferenceFragment.java
+++ b/src/com/android/settings/display/ColorModePreferenceFragment.java
@@ -37,7 +37,9 @@ import android.view.ViewGroup;
 import android.widget.ImageView;
 
 import androidx.annotation.VisibleForTesting;
+import androidx.preference.Preference;
 import androidx.preference.PreferenceScreen;
+import androidx.preference.SeekBarPreference;
 import androidx.viewpager.widget.PagerAdapter;
 import androidx.viewpager.widget.ViewPager;
 
@@ -53,10 +55,16 @@ import java.util.Arrays;
 import java.util.List;
 import java.util.Map;
 
+import com.crdroid.settings.preferences.SecureSettingSwitchPreference;
+
 @SuppressWarnings("WeakerAccess")
 @SearchIndexable
-public class ColorModePreferenceFragment extends RadioButtonPickerFragment {
+public class ColorModePreferenceFragment extends RadioButtonPickerFragment implements Preference.OnPreferenceChangeListener {
 
+    private static final String KEY_X_REALITY_ENGINE = "x_reality_engine_mode_enabled";
+    private static final String KEY_COLOR_BALANCE_RED = "color_balance_red";
+    private static final String KEY_COLOR_BALANCE_GREEN = "color_balance_green";
+    private static final String KEY_COLOR_BALANCE_BLUE = "color_balance_blue";
     private static final String KEY_COLOR_MODE_PREFIX = "color_mode_";
 
     private static final int COLOR_MODE_FALLBACK = COLOR_MODE_NATURAL;
@@ -80,6 +88,11 @@ public class ColorModePreferenceFragment extends RadioButtonPickerFragment {
     private ImageView[] mDotIndicators;
     private View[] mViewPagerImages;
 
+    private SecureSettingSwitchPreference mXRealityEnginePreference;
+    private SeekBarPreference mColorBalanceRed;
+    private SeekBarPreference mColorBalanceGreen;
+    private SeekBarPreference mColorBalanceBlue;
+
     @Override
     public void onAttach(Context context) {
         super.onAttach(context);
@@ -115,6 +128,35 @@ public class ColorModePreferenceFragment extends RadioButtonPickerFragment {
             mViewPager.setCurrentItem(selectedPosition);
             updateIndicator(selectedPosition);
         }
+        mXRealityEnginePreference = findPreference(KEY_X_REALITY_ENGINE);
+        mColorBalanceRed = findPreference(KEY_COLOR_BALANCE_RED);
+        mColorBalanceGreen = findPreference(KEY_COLOR_BALANCE_GREEN);
+        mColorBalanceBlue = findPreference(KEY_COLOR_BALANCE_BLUE);
+        if (mXRealityEnginePreference != null) {
+            mXRealityEnginePreference.setOnPreferenceChangeListener(this);
+            updateSeekBarsState(mXRealityEnginePreference.isChecked());
+        }
+    }
+
+    @Override
+    public boolean onPreferenceChange(Preference preference, Object newValue) {
+        if (preference.getKey().equals(KEY_X_REALITY_ENGINE)) {
+            boolean isEnabled = (Boolean) newValue;
+            updateSeekBarsState(isEnabled);
+        }
+        return true;
+    }
+
+    private void updateSeekBarsState(boolean isXRealityEngineEnabled) {
+        if (mColorBalanceRed != null) {
+            mColorBalanceRed.setEnabled(!isXRealityEngineEnabled);
+        }
+        if (mColorBalanceGreen != null) {
+            mColorBalanceGreen.setEnabled(!isXRealityEngineEnabled);
+        }
+        if (mColorBalanceBlue != null) {
+            mColorBalanceBlue.setEnabled(!isXRealityEngineEnabled);
+        }
     }
 
     @Override
-- 
2.43.0

